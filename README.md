# 자바 GUI와 MySQL을 이용한 캠핑카 예약 사이트 제작.
-------

### 1.요구사항 분석하기
캠핑카를 예약하기 위한 필수 요구사항을 분석합니다. 

| 구분        | 요구 사항                                                   | 상세 내용                                                                                                                                                                                                                                                                                                                                                                                        | 우선순위 |
|-------------|--------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| 로그인       | 일반 유저가 로그인 페이지에서 로그인 될 수 있도록 합니다.    | 유저 로그인 버튼을 누르면 로그인 UI 페이지로 이동해 id와 password를 입력합니다.<br>이때, id와 password는 user 테이블에 user_account, user_password 속성에 저장됩니다.<br>로그인 할 때는 user table의 id와 password를 전체 조회하여 해당하는 일반 유저 계정이 있는지 확인합니다.                                                                  | 1-1      |
| 로그인       | admin 유저가 로그인 페이지에서 로그인 될 수 있도록 합니다.    | admin 로그인 버튼을 누르면 자동으로 관리자 페이지로 이동합니다.<br>이때, 관리자 계정은 따로 로그인 과정 없이 자동으로 하드 코딩된 관리자 계정으로 로그인 처리합니다.                                                                                                                                                                                              | 1-2      |
| 관리자 기능   | 관리자가 데이터베이스를 초기화할 수 있도록 합니다.           | DELETE문을 통해 데이터를 모두 초기화하고,<br>test data는 하드코딩을 통해 초기화가 되도록 남아 있도록 만듭니다.                                                                                                                                                                                                                                                      | 2-1      |
| 관리자 기능   | 데이터베이스의 입력/삭제/변경 기능을 수행할 수 있도록 합니다. | 삭제/변경 조건식을 이용하여 유동적으로 삭제<br>예시:<br>String condition = inputField.getText();<br>String query = "DELETE FROM users WHERE " + condition;<br>stmt.executeUpdate(query);                                                                                                                                                                                   | 2-1      |
| 관리자 기능   | 전체 데이터베이스를 조회합니다.                            | SELECT * FROM [모든 테이블이름]을 통해서 모든 테이블의 내용을 조회합니다.                                                                                                                                                                                                                                                                                                  | 2-1      |
| 관리자 기능   | 캠핑카에 대한 내/외부 정비기록을 조회하고, 정비에 맞는 상세정보를 보여줍니다. | 캠핑카를 선택할 수 있는 UI를 구성 후, 선택되면 자체 정비 내역, 외부 정비 내역을 보여주고 선택할 수 있도록 합니다.<br>이후, 재고 정보 및 정비 shop 등 상세정보를 보여주기 위해 정비 shop 정보, 재고 정보, 정비 항목 등의 속성을 조회합니다.<br>예시:<br>SELECT * FROM car.fixlog<br>SELECT * FROM repair<br>SELECT item.stock, item.store, company FROM car.item<br>SELECT * FROM car.repair_shop | 2-2      |
| 관리자 기능   | 사용자가 직접 질의를 입력할 수 있는 UI를 통해 SQL 쿼리를 사용하여 데이터를 조회합니다. | SQL 쿼리를 입력할 수 있는 text창을 통해 데이터를 조회합니다.<br>추가 주의 사항: 테스트를 위해 4개 이상의 테이블 join과 부속컬럼, group by 등을 통해 사용하는 테스트용 질의 3개 이상 생성할 것                                                                                                                                                                                    | 2-2      |
| 일반 유저 기능 | 전체 캠핑카 데이터를 조회하고 선택합니다.                   | SELECT * FROM camping_car를 통해 전체 캠핑카를 조회합니다.                                                                                                                                                                                                                                                                                                               | 3-1      |
| 일반 유저 기능 | 선택한 캠핑카에 대한 대여 가능한 일자를 보여줍니다.         | 선택한 camping_car의 id를 가져와 rental 테이블에서 조회합니다.<br>이때 시작 일자, 대여 기간을 종합하여 대여 가능한 일자를 보여줍니다.                                                                                                                                                                                                                                             | 3-2      |
| 일반 유저 기능 | 선택한 캠핑카에 대한 대여 기능을 구현합니다.               | rental 테이블에 대여기간을 종합하여 대여 가능한 기간에 대해 대여 기능을 수행합니다.                                                                                                                                                                                                                                                                       | 3-2      |
| 일반 유저 기능 | 본인이 대여한 캠핑카에 대한 정보를 조회합니다.              | 서버쿼리 / join을 이용해 대여를 진행한 유저의 ID를 받아 rental 테이블에서 camping_car.id를 받아와 캠핑카 정보를 조회합니다.                                                                                                                                                                                                                                                 | 3-2      |
| 일반 유저 기능 | 본인이 대여한 캠핑카에 대해 캠핑카, 일정, 정비 등의 작업을 수정, 의뢰하는 기능 | 본인이 렌탈한 캠핑카에 대한 정보를 수정, 정비 의뢰 등의 기능을 수행합니다.<br>이때 제약조건에 맞추어 작업을 진행하도록 합니다.                                                                                                                                                                                                                                             | 3-3      |


### 2. ERD 구성
각 릴레이션 별 관계는 다음과 같다. 

### 3. 로그인 
관리자를 선택 할 경우, 워크벤치의 root유저로 자동으로 접속합니다. 
유저를 선택한 경우에는 User테이블를 조회하여 해당 아이디와 비밀번호가 맞는지 조회합니다. 맞는 경우, 워크벤치의 user1 계정으로 접속합니다. 
원래라면 SQL에 그대로 적용하는 것이 아닌 Hash Function을 이용하여 보안을 강화했겠지만 개발 편의 & 시간 문제로 그대로 저장했습니다. 
N번째 일반 유저의 아이디, 비번은 userN, passN으로 구성되어 있습니다. 

### 4. 관리자 기능
관리자는 크게 5가지 기능으로 구성됩니다. 
1. 전체 데이터 베이스 초기화
2. 데이터의 삽입, 삭제, 변경
3. 전체 데이터 베이스 조회
4. 차마다의 내/외부정비 내역과 그 정비 내역을 통한 부품 및, 외부 정비소의 정보를 확인 할 수 있습니다.
5. SQL쿼리문을 통해 조회 결과를 확인 할 수 있습니다. 

- 구체적인 요구사항에 맞추어 각 테이블에 12개의 샘플 데이터는 삭제 하지 않습니다. 
- 구체적 요구사항에 맞추어 삭제, 변경 과정은 조건식을 받아야만 작업을 수행할 수 있도록 하였습니다. 
- 입력받는 공간에 특수문자열, 형식에 맞지 않는 입력, 두 입력란을 바꿔 진행하는 등, 다양한 예외 케이스에 대해서 TEST를 진행하고 버그를 수정했습니다. 
- 각각의 9개의 모든 릴레이션을 선택하여 조회 할 수 있도록 구현하였습니다. 각 테이블의 컬럼수가 다르기 때문에 테이블 마다 동적으로 컬럼수를 확인하고 테이블을 보여주도록 하였습니다. 
- 캠핑카를 선택하면 해당 차의 자체(car_fix) 정비, 외부(repair) 정비 정보를 나누어 보여주고, 튜플을 focus하면 부품과 정비소 정보를 확인 할 수 있습니다.
- 구체적 요구사항에 맞추어 "테스팅을 위해서 테이블 4개 이상이 조인되면서 부속질의와 Group By를 동시에 사용하는 테스팅용 Select 질의"를 3개 소스코드 안에 주석처리 하여 삽입하였고, 의외에도 기본적인 SQL질의, 서브쿼리 질의, 유효하지 않은 질의 등등
다양한 질의를 만들어 TEST하였습니다. 


### 5. 일반 유저 기능
일반유저의 기능은 크게 다음과 같이 구성됩니다.
1. 캠핑카 조회 기능
2. 위에서 조회한 캠핑카에 대하여 대여 가능 일자를 보여주는 기능
3. 선택한 캠핑카/대여일자에 대한 대여 등록 기능
4. 본인이 대여한 캠핑카에 대한 정보를 보여주는 기능
5. 본인이 대여한 캠핑카에 대하여 조회하고 한 개 이상의 대여 정보를 “삭세”하는 기능
6. 본인이 대여한 캠핑카에 대하여 조회하여 다른 캠핑카로 변경하는 기능
7. 본인이 대여한 캠핑카에 대하여 조회하여 다른 일정으로 변경하는 기능
8. 본인이 대여한 캠핑카에 대하여 외부정비소에 정비를 의뢰하는 기능

위 기능은 "캠핑카 예약 기능", "내 캠핑카 관리 기능", "정비 기능" TAB으로 나누어 3개의 TAB으로 통합해 구성했습니다.

- 캠핑카 조회 버튼을 누르면 FUCUS 할 수 있는 캠핑카 정보들이 출력됩니다. 원하는 캠핑카에 FUCUS할 경우, Rental 테이블에서 
해당 캠핑카의 ID를 가진 정보를 가져와 대여 시작일 + 빌린 기간을 게산하여 대여가 불가능한 날짜를 보여줍니다. 
- 날짜 유효성을 검사하며 TEST를 진행하였고, 날짜 관련 버그를 수정하며 업데이트 했습니다. 
- 대여일자와 대여기간을 통해 유저가 캠핑카를 예약할 수 있도록 합니다. 이때, TEST는 FORM에 맞지 않는 대여일자, 음수 형식의 대여일자, 특수문자, 문자, 숫자 등등이 반영되지 않도록 예외처리를 진행하고 성공과 실패를 JOptionPane.showMessageDialog() 함수를 통해 사용자에게 알려줍니다. 
- 내 대여 내역 불러오기를 통해 내가 예약한 캠핑카 목록을 가져올 수 있습니다. 
- 마찬가지로 FUCUS가 가능하며, 선택된 해당 Rental테이블의 튜플을 삭제하거나 변경할 수 있습니다. 
- 일정을 변경하는 경우, 그 캠핑카의 변경된 일정이 이미 존재하는지 확인하고, 없다면 예약 변경을 수락합니다. 만약 그 일정에 누군가 빌리는 것이 예정되었다면 변경은 실패합니다. 
- 변경하려는 캠핑카의 ID를 가진 Rental테이블의 튜플을 가져오고 날짜애 이상이 없는지 확인하여 TEST하였습니다.
- 새로운 차로 바꾸려는 경우, 바꾸려는 차를 선택하고 위와 마찬가지로 TEST하여 기능을 구현합니다. 
- FUCUS한 튜플은 선택한 대여정보 삭제를 통해 DELETE가 가능합니다. 행에 대해서 선택이 가능하기 때문에 1개 이상의 행에 대해 삭제를 진행 할 수 있습니다. 
- 정비소의 경우, 내가 예약한 캠핑카에 한해서 정비를 의뢰할 캠핑카를 선택하고, 모든 정비소 중에서 하나를 선택합니다. 
- 정비를 요청할 메세지와 함께 정비요청을 진행할 수 있습니다.

### 6. 후기
자바 프로젝트를 통해 My SQL을 직접 다뤄보는 좋은 경험이었습니다. 
부족한 부분이 많은 프로젝트지만 직접 쿼리를 작성하고 데이터를 가져오는 과정에서 JOIN과 서브쿼리의 탐색 차이를 구체적으로 알수 있었고, 미쳐 생각하지 못한 이슈에 어떤 방식으로 해결할 것인지에 대한 소통과정, 비즈니스 로직을 구현하는 과정에서 신경쓰지 못해 코드가 스파게티 코드가 되는 등, 유지보수하기 좋은 코드와 확장성이 좋은 코드에 대해서 감을 잡을 수 있었던 것 같습니다. 